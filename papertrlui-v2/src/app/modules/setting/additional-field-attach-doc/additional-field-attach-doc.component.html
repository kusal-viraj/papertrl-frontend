<div>
<div class="grid">

  <div class="col-6">
    <h5 class="popup-header-label">Manage Attached Documents</h5>
  </div>
  <div class="col-6 text-right">
    <div class="fa fa-close side-drawer-icon"
         (click)="close()"></div>
  </div>
</div>
<h6 class="popup-header-label">Additional Field Detail</h6>
<p-table responsiveLayout="scroll" [value]="fieldDetails" [scrollable]="false" [lazy]="false" [loading]="false" [paginator]="false"
         styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm"
         [style]="{width:'900px'}">

  <ng-template pTemplate="colgroup">
    <colgroup>
      <col style="width:225px">
      <col style="width:225px">
      <col style="width:225px">
    </colgroup>
  </ng-template>

  <ng-template pTemplate="header">
    <tr>
      <th class="text-center" id="fName">Field Name
      </th>
      <th class="text-center" id="fType">Field Type
      </th>
      <th class="text-center" id="aStatus">Active Status
      </th>

    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item let-i="rowIndex">
    <tr>
      <td>
        {{item.fieldName}}
      </td>

      <td>
        {{item.fieldTypeName}}
      </td>

      <td class="text-center">
        <p-inputSwitch (onChange)="fieldStatusChanged(item)" [(ngModel)]="item.status"></p-inputSwitch>
      </td>
    </tr>
  </ng-template>
</p-table>
<h6 *ngIf="existingDocuments.length !== 0" class="subHeadingColour mt-6">Existing Documents</h6>

<p-table responsiveLayout="scroll" *ngIf="existingDocuments.length !== 0" [value]="existingDocuments" [scrollable]="true"
         [rowHover]="true" [lazy]="false" [loading]="false" [paginator]="false" [filterDelay]="0" scrollDirection="both"

         styleClass="p-datatable-sm p-datatable-striped detail-table" scrollHeight="200px" scrollable="true"
         [style]="{width:'1200px'}">

  <ng-template pTemplate="header">
    <tr>
      <th style="min-width:170px" pSortableColumn="moduleName" class="text-center sort-icon-wrapper" id="moduleName">Document Type
        <p-sortIcon  class="grid-sort-icon" field="moduleName"></p-sortIcon>
      </th>

      <th style="min-width:190px" pSortableColumn="sectionName" class="text-center sort-icon-wrapper" id="sectionName">Section
        <p-sortIcon  class="grid-sort-icon" field="sectionName"></p-sortIcon>
      </th>

<!--      <th pSortableColumn="attacher" class="text-center" id="attacher">Attached By-->
<!--        <p-sortIcon field="attacher"></p-sortIcon>-->
<!--      </th>-->

      <th style="min-width:170px" pSortableColumn="displayOrder" class="text-center sort-icon-wrapper" id="displayOrder">Display Order
        <p-sortIcon class="grid-sort-icon" field="displayOrder"></p-sortIcon>
      </th>

      <th *ngIf="fieldTypeString !== 'File Input'" style="min-width:185px" pSortableColumn="appearOnReport" class="text-center sort-icon-wrapper" id="appearOnExport">Include in Export Report
        <p-sortIcon class="grid-sort-icon" field="appearOnExport"></p-sortIcon>
      </th>

      <th *ngIf="fieldTypeString !== 'File Input'" style="min-width:175px" pSortableColumn="appearOnReport" class="text-center sort-icon-wrapper" id="appearOnReport">Show On PO Report
        <p-sortIcon class="grid-sort-icon" field="appearOnReport"></p-sortIcon>
      </th>

      <th *ngIf="fieldTypeString !== 'File Input'" style="min-width: 240px" pSortableColumn="labelOnPoReport" class="text-center sort-icon-wrapper" id="labelOnPoReport">Field Name Shown In PO Report
        <p-sortIcon class="grid-sort-icon" field="labelOnPoReport"></p-sortIcon>
      </th>

      <th style="min-width:162px" pSortableColumn="required" class="text-center sort-icon-wrapper" id="required">Required
        <p-sortIcon class="grid-sort-icon" field="required"></p-sortIcon>
      </th>

      <th style="min-width:162px" pSortableColumn="status" class="text-center sort-icon-wrapper" id="dStatus">Active Status
        <p-sortIcon class="grid-sort-icon" field="status"></p-sortIcon>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item let-i="rowIndex">
    <tr>
      <td>
        {{item.moduleName}}
      </td>
      <td>
        {{item.sectionName}}
      </td>

<!--      <td>-->
<!--        {{item.attacher}}-->
<!--      </td>-->

      <td class="text-center">
        <p-inputNumber class="p-fluid text-right display-order" [(ngModel)]="item.displayOrder" mode="decimal" inputId="withoutgrouping"
                       [min]="0" [max]="50" [useGrouping]="false">
        </p-inputNumber>
      </td>

      <td class="text-center" *ngIf="fieldTypeString !== 'File Input'">
        <p-checkbox *ngIf="showExportCheck(item.moduleId)" [(ngModel)]="item.appearOnExport"
                    binary="true" inputId="binary"></p-checkbox>
      </td>

      <td *ngIf="fieldTypeString !== 'File Input'" class="text-center">
        <p-checkbox *ngIf="item.moduleId === 2" [(ngModel)]="item.appearOnReport" (onChange)="checkAdditionalFieldCountOnPOReport(item)"
                    binary="true" inputId="binary"></p-checkbox>
      </td>

      <td *ngIf="fieldTypeString !== 'File Input'">
        <input *ngIf="item.moduleId === 2" pInputText class="p-fluid text-right po-label-wrapper"
               [disabled]="!item.appearOnReport" maxlength="6" (keyup)="patchSectionHeadingLabelAsSame(item)"
               [(ngModel)]="item.headerAppearOnReport">
      </td>

      <td class="text-center">
        <p-checkbox [(ngModel)]="item.required" binary="true" (onChange)="requiredStatusChanged(item)" inputId="binary"></p-checkbox>
      </td>

      <td class="text-center">
        <p-inputSwitch [disabled]="!fieldDetails[0].status" (onChange)="documentStatusChanged(item)"
                       [(ngModel)]="item.status"></p-inputSwitch>

      </td>
    </tr>
  </ng-template>
</p-table>

<h6 class="subHeadingColour mt-3 mb-4">Attach to</h6>
<div class="mb-5">
<form class="mb-0"  [formGroup]="documentForm">

  <div class="grid">
    <div class="field pb-3 col-12 xl:col-6 lg:col-6 md:col-12 sm:col-12">
      <label class="label-wrapper" for="section">Select Document Type And Section</label>
      <span class="p-float-label multi-select-label p-fluid">
        <p-multiSelect [options]="sections" [group]="true" optionValue="value" [maxSelectedLabels]="1"
                       formControlName="documentRelation" optionDisabled="inactive" optionLabel="label"
                       id="section" optionGroupChildren="items" class="responsive-multiselect" appendTo="body">
          <ng-template let-group pTemplate="group">
            <div class="flex p-ai-center">
              <span class="m-2 font-bold">{{group.label}}</span>
            </div>
          </ng-template>
        </p-multiSelect>
        </span>
      <div class="p-invalid text-align-left"
           *ngIf="documentForm.get('documentRelation').dirty && documentForm.get('documentRelation').errors">
        Section is required
      </div>
    </div>
  </div>
</form>
</div>


<div class="grid  m-0 p-0 fixed panel-footer footer">
  <div class="col-12 button-set-wrapper form-footer-button">
  <div class="pull-right">
    <button pButton type="button" label="Reset" (click)="reset()" [disabled]="loading"
            class="p-button-outlined p-button-sm margin-right" icon="fa-solid fa-rotate-right"></button>&nbsp;
    <button pButton type="button"   [icon]="!loading ? 'pi pi-save': 'pi pi-spinner'"
            [disabled]="loading || !fieldDetails[0]?.status" (click)="submit()"
            class="p-button-sm" iconPos="left" label="Save"></button>
  </div>
  </div>
</div>
</div>
<!--Create Additional Field-->

<p-confirmDialog #draft1 key="additionalFieldCreateConfirmation" header="Are you sure?" appendTo="body"
                 icon="conf-delete-icon pi pi-exclamation-triangle">
  <p-footer>
    <button type="button" class="conf-cancel-btn p-button-outlined" pButton icon="pi pi-times" label="Cancel"
            (click)="draft1.reject()"></button>
    <button type="button" class="conf-reject-btn" pButton icon="pi pi-check" label="Yes, Print it"
            (click)="draft1.accept()"></button>
  </p-footer>
</p-confirmDialog>
