<p-table responsiveLayout="scroll" id="columnSelect" #dt [columns]="selectedColumns" (change)="onTableChanged()" (onColResize)="onTableChanged()"
         [hidden]="tableSupportBase.isVisibleTable" (onFilter)="tableSupportBase.onFilter(dt)"
         (onSort)="tableSupportBase.onSort(dt)"
         (onRowSelect)="tableSupportBase.rowSelected(dt,null)" (onRowUnselect)="tableSupportBase.rowSelected(dt,null)"
         (onColReorder)="onTableChanged()" [(selection)]="tableSupportBase.rows"
         [value]="tableSupportBase.dataSource" columnResizeMode="expand"
         dataKey="id" [reorderableColumns]="true" [rowHover]="true" [lazy]="true" (onLazyLoad)="loadData($event)"
         [responsive]="false" selectionMode="multiple" scrollHeight="350px" [scrollable]="true"
         stateStorage="session" stateKey="{{tableKeyEnum.TASK_TABLE_KEY}}" [rows]="25" [showCurrentPageReport]="true"
         [rowsPerPageOptions]="[25, 50, 75]" [loading]="tableSupportBase.loading" [resizableColumns]="false" [tableStyle]="{'min-width': tableSupportBase.minWidth}"
         styleClass="p-datatable-md p-datatableResponsive p-datatable-striped p-datatable-gridlines"
         [totalRecords]="tableSupportBase.totalRecords" [paginator]="true"
         currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0">

  <ng-template pTemplate="caption">
    <div class="grid" [style]="{'align-items': 'center'}">
      <div class="col-12 p-p-0">
        <p-multiSelect #columnSelect [options]="tableSupportBase.hiddenInOptions"
                       [defaultLabel]="tableSupportBase.selectedColumnCount" [showHeader]="false"
                       [(ngModel)]="selectedColumns" optionLabel="header" [displaySelectedLabel]="false"
                       class="table-column-dropdown"></p-multiSelect>
        <button pButton icon="pi pi-refresh" type="button" label="Refresh"
                (click)="loadData(tableSupportBase.searchFilterDto)"
                class="p-button-outlined pull-right p-button-sm"></button>
      </div>
    </div>
  </ng-template>

  <ng-template *ngIf="tableSupportBase.isTableInResponsive" pTemplate="colgroup" let-columns>
    <colgroup *ngIf="tableSupportBase.isTableInResponsive">
      <col *ngFor="let col of columns">
    </colgroup>
  </ng-template>

  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let col of columns" pResizableColumn [pResizableColumnDisabled]="!col.isReSizable"
          [ngStyle]="{'text-align': col.align}"
          [pReorderableColumnDisabled]="!col.isReOrderable" pReorderableColumn pSortableColumn="{{col.sortableField}}">
        {{col.header}}
        <p-sortIcon *ngIf="col.isSortable" field="{{col.sortableField}}"></p-sortIcon>
      </th>
    </tr>
    <tr>
      <th *ngFor="let col of columns">
        <div *ngIf="col.searchType == enums.CHECKBOX" [ngStyle]="{'text-align': col.align}">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </div>
        <div *ngIf="col.searchType == enums.MULTISELECT" class="p-fluid">
          <p-columnFilter field="{{col.field}}" matchMode="contains" display="menu" [showMatchModes]="false"
                          [showOperator]="false" [showAddButton]="false">
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <p-multiSelect [ngModel]="value" [options]="col.multiSelectValues" placeholder="Any"
                             (onChange)="filter($event.value)" optionLabel="name">
                <ng-template let-option pTemplate="item">
                  <div class="p-multiselect-representative-option">
                    <span class="ml-1">{{option.name}}</span>
                  </div>
                </ng-template>
              </p-multiSelect>
            </ng-template>
          </p-columnFilter>
        </div>

        <div *ngIf="col.searchType == enums.INPUT" class="p-fluid">
          <p-columnFilter matchMode="contains" type="text" [placeholder]="col.placeholder" field="{{col.field}}">
            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
              <input pInputText type="text" [placeholder]="col.placeholder"
                     (keyup)="filter($event.target.value)" [ngModel]="value" class="p-column-filter">
            </ng-template>
          </p-columnFilter>
        </div>


        <div *ngIf="col.searchType == enums.NUMERIC" class="p-fluid">
          <div class="p-inputgroup">
            <input type="text" pInputText  placeholder="0.00"  #val1 [options]="{prefix: '', thousands: '', decimal: '.'}" currencyMask
                   (keyup)="tableSupportBase.filterRange(dt, val1.value, val2.value, col.field, $event)">

            <span class="p-inputgroup-addon field-clear-button">< ></span>

            <input type="text" pInputText placeholder="0.00" #val2 [options]="{prefix: '', thousands: '', decimal: '.'}" currencyMask
                   (keyup)="tableSupportBase.filterRange(dt, val1.value, val2.value, col.field, $event)">
          </div>
        </div>

        <div *ngIf="col.searchType == enums.NUMBER" class="p-fluid" [style]="{'text-align': 'center'}">
          <input pInputText pKeyFilter="money" type="number" [placeholder]="col.placeholder"
                 [value]="dt.filters[ col.field]?.value === undefined ? null : dt.filters[ col.field]?.value"
                 (input)="dt.filter($event.target.value, col.field, 'contains')" class="p-column-filter">
        </div>
        <div *ngIf="col.searchType == enums.DATE" class="p-fluid" [style]="{'text-align': 'center'}">
          <p-calendar (onSelect)="tableSupportBase.onDateSelect(dt, selectedLaw.value, col.field)" #selectedLaw
                      (onClearClick)="dt.filter('', col.field, 'contains')"
                      appendTo="body" name="{{col.fieldID}}" selectionMode="range"
                      [showButtonBar]="true" styleClass="p-column-filter" [placeholder]="col.placeholder"
                      [readonlyInput]="true" dateFormat="yy-mm-dd"></p-calendar>
        </div>
        <div *ngIf="col.searchType == enums.DROPDOWN" class="p-fluid">
          <p-dropdown appendTo="body" optionLabel="name" optionValue="id" [options]="getDropDowns(col)" [showClear]="true"
                      (onChange)="dt.filter($event.value, col.field, 'contains')"
                      placeholder="Any"></p-dropdown>
        </div>


      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-customer let-columns="columns">
    <tr>
      <td *ngFor="let col of columns" [ngStyle]="{'text-align': col.align}"
          [class.freeze-right]="col.frozenDirection == 'right'" [ngClass]="col.searchType == enums.ACTION_BUTTON ? 'vendor-table-action-btn' : null">
        <span class="p-column-title">{{col.header}}</span>

        <span *ngIf="col.field == enums.CHECKBOX">
          <p-tableCheckbox [value]="customer"></p-tableCheckbox>
        </span>

        <span *ngIf="col.searchType ==  enums.ACTION_BUTTON" class="td-actionButton">
          <button type="button" pButton class="table-action-btn" icon="pi pi-chevron-down" iconPos="right"
                  [disabled]="tableSupportBase.actionButtonList(customer['status']).length === 0"
                  label="Action" (click)="menu.toggle($event); actionButtonClick(customer)"></button>
          <p-menu #menu [popup]="true" appendTo="body"
                  [model]="tableSupportBase.actionButtonList(customer['status'])"></p-menu>
        </span>
        <span *ngIf="col.field == 'status'"
              [class]="'customer-badge status-'  + tableSupportBase.getStatus(customer[col.field])">{{tableSupportBase.getStatus(customer[col.field])}}</span>

        <span *ngIf="col.field !== 'status'">{{customer[col.field]}}</span>
      </td>
    </tr>
  </ng-template>


    <ng-template pTemplate="emptymessage">
      <div class="text-center grid table-empty-data">
          <div class="col-12">
            <i class="fa-solid fa-magnifying-glass"></i><br>
            <p>There are no records found</p>
          </div>
      </div>
    </ng-template>
</p-table>

<p-confirmDialog #cd key="task" header="Are you sure?" appendTo="body"  icon="conf-delete-icon pi pi-exclamation-triangle">
  <p-footer>
    <button type="button" class="conf-cancel-btn p-button-outlined" pButton icon="pi pi-times" label="Cancel" (click)="cd.reject()"></button>
    <button type="button" class="conf-reject-btn" pButton icon="pi pi-check" label="Yes, delete!" (click)="cd.accept()"></button>
  </p-footer>
</p-confirmDialog>
